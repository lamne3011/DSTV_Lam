<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSTV Processor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}.container{background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);padding:40px;max-width:600px;width:100%}.login-container{display:block}.app-container{display:none}h1{color:#667eea;text-align:center;margin-bottom:10px;font-size:32px}.subtitle{text-align:center;color:#999;margin-bottom:30px;font-size:14px}.lock-icon{text-align:center;font-size:60px;margin-bottom:20px}.password-group{margin-bottom:20px}.password-group label{display:block;margin-bottom:8px;color:#666;font-weight:500}.password-input-wrapper{position:relative}input[type="password"],input[type="text"]{width:100%;padding:15px;border:2px solid #ddd;border-radius:10px;font-size:16px;transition:all 0.3s ease}input[type="password"]:focus,input[type="text"]:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}.toggle-password{position:absolute;right:15px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:20px;user-select:none}.upload-area{border:3px dashed #667eea;border-radius:15px;padding:50px 40px;text-align:center;transition:all 0.3s ease;cursor:pointer;background:#f8f9ff}.upload-area:hover{border-color:#764ba2;background:#f0f2ff;transform:translateY(-2px)}.upload-area.dragover{border-color:#764ba2;background:#e8eaff;transform:scale(1.02)}#fileInput{display:none}.upload-icon{font-size:60px;margin-bottom:15px}.upload-text{color:#666;font-size:18px;margin-bottom:10px;font-weight:500}.upload-subtext{color:#999;font-size:14px}.file-name{color:#667eea;font-weight:bold;margin-top:20px;padding:10px 20px;background:#f0f2ff;border-radius:8px;display:none}button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:18px 40px;border-radius:30px;font-size:18px;font-weight:bold;cursor:pointer;margin-top:25px;width:100%;transition:all 0.3s ease;box-shadow:0 5px 15px rgba(102,126,234,0.4)}button:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 10px 25px rgba(102,126,234,0.6)}button:active:not(:disabled){transform:translateY(-1px)}button:disabled{background:#ccc;cursor:not-allowed;box-shadow:none}.logout-btn{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);padding:12px 30px;font-size:14px;margin-top:15px}.status{margin-top:25px;padding:18px;border-radius:12px;text-align:center;display:none;font-weight:500}.status.success{background:#d4edda;color:#155724;border:2px solid #c3e6cb}.status.error{background:#f8d7da;color:#721c24;border:2px solid #f5c6cb}.status.processing{background:#fff3cd;color:#856404;border:2px solid #ffeaa7}.loader{border:5px solid #f3f3f3;border-top:5px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto;display:none}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.footer{text-align:center;margin-top:30px;color:#999;font-size:12px}</style>
</head>
<body>
    <div class="container">
        <div class="login-container" id="loginContainer">
            <h1>üîê DSTV Processor</h1>
            <div class="subtitle">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</div>
            <div class="lock-icon">üîí</div>
            <div class="password-group">
                <label for="passwordInput">M·∫≠t kh·∫©u</label>
                <div class="password-input-wrapper">
                    <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
                    <span class="toggle-password" id="togglePassword">üëÅÔ∏è</span>
                </div>
            </div>
            <button id="loginBtn">ƒêƒÉng Nh·∫≠p</button>
            <div class="status" id="loginStatus"></div>
            <div class="footer">Made with ‚ù§Ô∏è by S∆°nL√¢m</div>
        </div>
        <div class="app-container" id="appContainer">
            <h1>üîÑ DSTV Processor</h1>
            <div class="subtitle">T·ª± ƒë·ªông x·ª≠ l√Ω file Excel DSTV</div>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìä</div>
                <div class="upload-text">K√©o th·∫£ file Excel v√†o ƒë√¢y</div>
                <div class="upload-subtext">ho·∫∑c click ƒë·ªÉ ch·ªçn file ‚Ä¢ H·ªó tr·ª£ .xlsx, .xls</div>
                <div class="file-name" id="fileName"></div>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
            <button id="processBtn" disabled>X·ª≠ L√Ω File</button>
            <button class="logout-btn" id="logoutBtn">ƒêƒÉng Xu·∫•t</button>
            <div class="loader" id="loader"></div>
            <div class="status" id="status"></div>
            <div class="footer">Made with ‚ù§Ô∏è by S∆°nL√¢m</div>
        </div>
    </div>
    <script>eval(function(_0x4a2b,_0x5c3d,_0x6e4f,_0x7f5g,_0x8g6h,_0x9h7i){_0x8g6h=function(_0x6e4f){return(_0x6e4f<_0x5c3d?'':_0x8g6h(parseInt(_0x6e4f/_0x5c3d)))+((_0x6e4f=_0x6e4f%_0x5c3d)>35?String.fromCharCode(_0x6e4f+29):_0x6e4f.toString(36))};if(!''.replace(/^/,String)){while(_0x6e4f--)_0x9h7i[_0x8g6h(_0x6e4f)]=_0x7f5g[_0x6e4f]||_0x8g6h(_0x6e4f);_0x7f5g=[function(_0x8g6h){return _0x9h7i[_0x8g6h]}];_0x8g6h=function(){return'\\w+'};_0x6e4f=1};while(_0x6e4f--)if(_0x7f5g[_0x6e4f])_0x4a2b=_0x4a2b.replace(new RegExp('\\b'+_0x8g6h(_0x6e4f)+'\\b','g'),_0x7f5g[_0x6e4f]);return _0x4a2b}('const P=\'d6b96776c5282ab301133de33c53c7bef6e5922a0ef23bbeb3967ef12e85c5b7\';async function Q(a){const b=new TextEncoder().encode(a),c=await crypto.subtle.digest(\'SHA-256\',b),d=Array.from(new Uint8Array(c)),e=d.map(f=>f.toString(16).padStart(2,\'0\')).join(\'\');return e}const R=document.getElementById(\'loginContainer\'),S=document.getElementById(\'appContainer\'),T=document.getElementById(\'passwordInput\'),U=document.getElementById(\'loginBtn\'),V=document.getElementById(\'loginStatus\'),W=document.getElementById(\'togglePassword\'),X=document.getElementById(\'logoutBtn\');W.addEventListener(\'click\',()=>{const a=T.type===\'password\'?\'text\':\'password\';T.type=a;W.textContent=a===\'password\'?\'üëÅÔ∏è\':\'üôà\'});T.addEventListener(\'keypress\',a=>{if(a.key===\'Enter\')U.click()});U.addEventListener(\'click\',async()=>{const a=T.value;if(!a){Y(\'error\',\'‚ùå Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u\');return}Y(\'processing\',\'‚è≥ ƒêang x√°c th·ª±c...\');const b=await Q(a);if(b===P){Y(\'success\',\'‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!\');setTimeout(()=>{R.style.display=\'none\';S.style.display=\'block\'},1000)}else{Y(\'error\',\'‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!\');T.value=\'\';T.focus()}});X.addEventListener(\'click\',()=>{S.style.display=\'none\';R.style.display=\'block\';T.value=\'\';Z()});function Y(a,b){V.className=`status ${a}`;V.textContent=b;V.style.display=\'block\'}function Z(){V.style.display=\'none\'}const A=document.getElementById(\'uploadArea\'),B=document.getElementById(\'fileInput\'),C=document.getElementById(\'processBtn\'),D=document.getElementById(\'fileName\'),E=document.getElementById(\'status\'),F=document.getElementById(\'loader\');let G=null;A.addEventListener(\'click\',()=>B.click());B.addEventListener(\'change\',a=>{H(a.target.files[0])});A.addEventListener(\'dragover\',a=>{a.preventDefault();A.classList.add(\'dragover\')});A.addEventListener(\'dragleave\',()=>{A.classList.remove(\'dragover\')});A.addEventListener(\'drop\',a=>{a.preventDefault();A.classList.remove(\'dragover\');H(a.dataTransfer.files[0])});function H(a){if(!a)return;if(!a.name.match(/\\.(xlsx|xls)$/)){I(\'error\',\'‚ùå Vui l√≤ng ch·ªçn file Excel (.xlsx ho·∫∑c .xls)\');return}G=a;D.textContent=`üìÑ ${a.name}`;D.style.display=\'block\';C.disabled=false;J()}C.addEventListener(\'click\',K);function L(a){if(!a)return\'\';return a.normalize(\'NFC\')}function K(){if(!G)return;I(\'processing\',\'‚è≥ ƒêang x·ª≠ l√Ω file... Vui l√≤ng ƒë·ª£i\');F.style.display=\'block\';C.disabled=true;const a=new FileReader();a.onload=b=>{try{const c=new Uint8Array(b.target.result),d=XLSX.read(c,{type:\'array\'}),e=d.Sheets[d.SheetNames[0]];let f=XLSX.utils.sheet_to_json(e);const g=/^DA.*|^RD.*|^RS.*|^ZT.*|^MC.*|^MR.*|^KG.*|^GA.*|^GC.*|^GD.*|^GE.*|^GW.*|^GF.*|^GZ.*|^WE.*|^WG.*|^MG.*|^MJ.*|^MF.*|^HA.*|^MD.*|^ME.*|^CA.*|^CM.*|^V0.*|^VA.*|^C5.*|^E0.*|^E1.*|^EA.*|^EP.*|^MA.*|^H0.*|^MS.*/i;f=f.filter(h=>{const i=h[\'Labcode\']||\'\';return g.test(i)});f.sort((h,i)=>{const j=(h[\'Labcode\']||\'\').localeCompare(i[\'Labcode\']||\'\');if(j!==0)return j;return(i[\'Sample Type\']||\'\').localeCompare(h[\'Sample Type\']||\'\')});f=f.map(h=>{const i={};Object.keys(h).forEach(j=>{if(![\'Testcode\',\'Cardcode\',\'No.\'].includes(j))i[j]=h[j]});return i});f=f.map(h=>{if(h[\'Handover Note\'])h[\'Handover Note\']=L(String(h[\'Handover Note\']));if(h[\'Cancer Note\'])h[\'Cancer Note\']=L(String(h[\'Cancer Note\']));return h});f=f.map(h=>{const i=h[\'Labcode\']||\'\',j=h[\'Handover Note\']||\'\',k=/tr·ªØ|tru/i.test(j);let l=-100;if(/^E[1|0]|^EP|^EA/.test(i))l=3;else if(/^MA/.test(i))l=2;else if(/^C5/.test(i))l=1;else if(/^CA|^CM/.test(i))l=0;else if(/^RD|^RS|^DA/.test(i))l=-1;else if(/^MD|^ME|^MS/.test(i))l=-2;else if(/^HA|^H0/.test(i))l=-3;else if(/^ZT/.test(i))l=-4;else if(/^GW|^GZ|^GD|^KG|^GE|^GF/.test(i))l=-5;else if(/^GA/.test(i))l=-6;else if(/^GC/.test(i))l=-7;else if(/^WE|^WG/.test(i))l=-8;else if(/^MJ|^MG/.test(i))l=-9;else if(/^MC|^MR/.test(i))l=-11;else if(/^MF/.test(i))l=-13;if(/^M[CR](?![AG])/.test(i))l=-10;if(/^MF(?![AG])/.test(i))l=-12;if(k)l=4;h._priority=l;return h});f.sort((h,i)=>{if(h._priority!==i._priority)return i._priority-h._priority;return(h[\'Labcode\']||\'\').localeCompare(i[\'Labcode\']||\'\')});f=f.map(h=>{delete h._priority;return h});f=f.map((h,i)=>{const j=h[\'Labcode\']||\'\',k=h[\'Sample Type\']||\'\',l={STT:i+1,Labcode:j,Note:\'\',\'Note 2\':\'\'};if(/^M[CRGFJ](?![AG])|^MG|^MJ/.test(j))l.Note=\'Ultrashear\';if(/^WE|^WG/.test(j))l.Note=\'USE 1V LIB\';if(/·ªêng m√°u/.test(k))l[\'Note 2\']=\'\';else if(/D·ªãch ·ªëi kh√¥ng nu√¥i c·∫•y/.test(k))l[\'Note 2\']=\'·ªëi\';else if(/D·ªãch ·ªëi ƒë√£ nu√¥i c·∫•y/.test(k))l[\'Note 2\']=\'·ªëi nc\';else if(/M√°u ·ªëng Streck/.test(k))l[\'Note 2\']=\'\';else if(/M√¥ \\(Epp\\)/.test(k))l[\'Note 2\']=\'\';else if(/D·ªãch m√†ng ph·ªïi/.test(k))l[\'Note 2\']=\'dmp\';else if(/Gai nhau kh√¥ng nu√¥i c·∫•y/.test(k))l[\'Note 2\']=\'gai\';else if(/M√¥ gai nhau/.test(k))l[\'Note 2\']=\'gai\';else if(/^Gai nhau/.test(k))l[\'Note 2\']=\'gai\';else if(/gDNA/.test(k))l[\'Note 2\']=\'gDNA\';else if(/^Ph·∫øt/.test(k))l[\'Note 2\']=\'bs\';else if(/M√¥ thai s·∫£y/.test(k))l[\'Note 2\']=\'mts\';Object.keys(h).forEach(m=>{if(m!==\'Labcode\')l[m]=h[m]});return l});const n=XLSX.utils.book_new(),o=XLSX.utils.json_to_sheet(f);XLSX.utils.book_append_sheet(n,o,\'DSTV\');const p=\'DSTV_lam.xlsx\';XLSX.writeFile(n,p);I(\'success\',`‚úÖ Th√†nh c√¥ng! ƒê√£ t·∫£i xu·ªëng: ${p}`);F.style.display=\'none\';C.disabled=false}catch(q){console.error(\'Processing error:\',q);I(\'error\',`‚ùå L·ªói khi x·ª≠ l√Ω: ${q.message}`);F.style.display=\'none\';C.disabled=false}};a.onerror=()=>{I(\'error\',\'‚ùå L·ªói khi ƒë·ªçc file\');F.style.display=\'none\';C.disabled=false};a.readAsArrayBuffer(G)}function I(a,b){E.className=`status ${a}`;E.textContent=b;E.style.display=\'block\'}function J(){E.style.display=\'none\'}',62,62,'||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||'.split('|'),0,{}))</script>
</body>
</html>
